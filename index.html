<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nube de Recuerdos</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;1,400&family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
            background: linear-gradient(135deg, #FEB195, #F67280, #C06C84, #6C5B7B, #355C7D);
            background-image: url('https://www.transparenttextures.com/patterns/floral-pattern.png'), linear-gradient(135deg, #FEB195, #F67280, #C06C84, #6C5B7B, #355C7D);
            background-blend-mode: overlay;
            color: #333;
            margin: 0;
            padding: 30px 0;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }

        .container {
            max-width: 850px;
            width: 95%;
            background: rgba(255, 255, 255, 0.92);
            backdrop-filter: blur(15px);
            padding: 60px 40px;
            border-radius: 35px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
            animation: fadeIn 1.8s ease;
            border: 1px solid rgba(246, 114, 128, 0.2);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(40px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .logo-text {
            font-family: 'Playfair Display', serif;
            font-size: 4em;
            font-weight: 700;
            background: linear-gradient(45deg, #F67280, #C06C84, #6C5B7B);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
            margin-bottom: 15px;
            letter-spacing: 2px;
        }

        h1 {
            font-family: 'Playfair Display', serif;
            text-align: center;
            color: #355C7D;
            font-size: 3em;
            margin: 0 0 15px;
            font-style: italic;
        }

        .subtitle {
            text-align: center;
            font-size: 1.4em;
            color: #6C5B7B;
            margin-bottom: 50px;
            font-weight: 400;
            font-style: italic;
        }

        .section {
            margin-bottom: 60px;
            padding: 40px;
            border-radius: 30px;
            background: rgba(255, 255, 255, 0.8);
            box-shadow: 0 15px 30px rgba(0,0,0,0.12);
            transition: all 0.5s ease;
            border: 2px solid rgba(246, 114, 128, 0.3);
        }

        .section:hover {
            transform: translateY(-15px);
            box-shadow: 0 20px 40px rgba(246, 114, 128, 0.2);
        }

        h2 {
            font-family: 'Playfair Display', serif;
            color: #355C7D;
            text-align: center;
            font-size: 2em;
            margin-bottom: 25px;
            font-style: italic;
        }

        button {
            background: linear-gradient(45deg, #F67280, #C06C84);
            color: white;
            border: none;
            padding: 18px 40px;
            border-radius: 60px;
            cursor: pointer;
            font-size: 1.2em;
            font-weight: 600;
            transition: all 0.4s ease;
            box-shadow: 0 8px 20px rgba(246, 114, 128, 0.4);
            width: 100%;
            max-width: 350px;
            margin: 25px auto;
            display: block;
            letter-spacing: 1px;
        }

        button:hover {
            background: linear-gradient(45deg, #C06C84, #6C5B7B);
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(192, 108, 132, 0.5);
        }

        input[type="file"], textarea {
            width: 100%;
            padding: 18px;
            margin: 25px 0;
            border: 2px solid #F67280;
            border-radius: 20px;
            font-size: 1.2em;
            background: rgba(255, 255, 255, 0.95);
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        input[type="file"]:focus, textarea:focus {
            border-color: #C06C84;
            box-shadow: 0 10px 25px rgba(192, 108, 132, 0.2);
            outline: none;
        }

        #upload-status, #dedication-status {
            text-align: center;
            margin: 30px 0;
            font-weight: 600;
            font-size: 1.3em;
            color: #355C7D;
            min-height: 30px;
        }

        .success {
            color: #355C7D;
            animation: pulse 1s ease;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="logo-text">Nube de Recuerdos ‚òÅ</div>
        <h1>¬°Bienvenidos!</h1>
        <p class="subtitle">Comparte los momentos m√°s especiales con amor y elegancia</p>

        <div class="section">
            <h2>üì∏ Comparte tus fotos y videos</h2>
            <input type="file" id="media-upload" accept="image/*,video/*" multiple>
            <button onclick="uploadMedia()">Subir a la Nube ‚òÅ</button>
            <p id="upload-status"></p>
        </div>

        <div class="section">
            <h2>‚úçÔ∏è Dedica unas palabras al festejado</h2>
            <textarea id="dedication" rows="8" placeholder="Escribe aqu√≠ tu mensaje lleno de cari√±o y buenos deseos..."></textarea>
            <button onclick="saveDedication()">Enviar dedicatoria</button>
            <p id="dedication-status"></p>
        </div>
    </div>

    <script>
        const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbxWOK4FFyzemHpBENq87ySve-OYG87-ecjlqvSum56iZrqwKQVDEpAc94wJQBy8Cnm1/exec';

        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
            });
        }

        async function uploadMedia() {
            const files = document.getElementById('media-upload').files;
            if (files.length === 0) {
                document.getElementById('upload-status').textContent = 'Selecciona al menos un archivo.';
                return;
            }

            document.getElementById('upload-status').innerHTML = 'Subiendo... ‚è≥';
            const fileArray = [];
            for (let file of files) {
                const base64 = await fileToBase64(file);
                fileArray.push({
                    name: `${new Date().toISOString().slice(0,19).replace(/:/g,"-")}_${file.name}`,
                    mimeType: file.type || 'application/octet-stream',
                    data: base64.split(',')[1]
                });
            }

            try {
                const response = await fetch(WEB_APP_URL, {
                    method: 'POST',
                    body: JSON.stringify({ type: 'media', files: fileArray })
                });
                const result = await response.json();
                if (result.status === 'success') {
                    document.getElementById('upload-status').innerHTML = '<span class="success">¬°Fotos y videos subidos con √©xito! ‚ú®</span>';
                } else {
                    document.getElementById('upload-status').textContent = 'Error al subir. Intenta de nuevo.';
                }
            } catch (err) {
                document.getElementById('upload-status').textContent = 'Fallo de red. Verifica tu conexi√≥n.';
            }
        }

        async function saveDedication() {
            const text = document.getElementById('dedication').value.trim();
            if (!text) {
                document.getElementById('dedication-status').textContent = 'Escribe tu mensaje.';
                return;
            }

            document.getElementById('dedication-status').innerHTML = 'Guardando dedicatoria... ‚è≥';
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('p', 'mm', 'a4');
            doc.setFillColor(254, 177, 149);
            doc.rect(0, 0, 210, 297, 'F');
            doc.setDrawColor(246, 114, 128);
            doc.setLineWidth(4);
            doc.roundedRect(15, 15, 180, 267, 15, 15, 'S');
            doc.setDrawColor(246, 114, 128);
            doc.line(30, 50, 180, 50);
            doc.line(30, 240, 180, 240);
            doc.setFont('helvetica', 'italic');
            doc.setFontSize(28);
            doc.setTextColor(53, 92, 125);
            doc.text('Dedicatoria Especial', 105, 40, {align: 'center'});
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(16);
            doc.setTextColor(53, 92, 125);
            const split = doc.splitTextToSize(text, 150);
            doc.text(split, 105, 70, {align: 'center'});
            doc.setFontSize(12);
            doc.setTextColor(108, 91, 123);
            doc.text(`Enviado el ${new Date().toLocaleString('es-ES')}`, 105, 260, {align: 'center'});

            const pdfBase64 = doc.output('datauristring').split(',')[1];
            const fileName = `Dedicatoria_${new Date().toISOString().slice(0,19).replace(/:/g,"-")}.pdf`;

            try {
                const response = await fetch(WEB_APP_URL, {
                    method: 'POST',
                    body: JSON.stringify({ type: 'dedication', pdfData: pdfBase64, fileName: fileName })
                });
                const result = await response.json();
                if (result.status === 'success') {
                    document.getElementById('dedication-status').innerHTML = '<span class="success">¬°Dedicatoria guardada con elegancia! ‚ú®‚ù§Ô∏è</span>';
                } else {
                    document.getElementById('dedication-status').textContent = 'Error al guardar.';
                }
            } catch (err) {
                document.getElementById('dedication-status').textContent = 'Fallo de red.';
            }

            document.getElementById('dedication').value = '';
        }
    </script>
</body>
</html>